<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <link rel="stylesheet" href="./iphone.css">
</head>

<body>
  <!-- 音响 -->
  <div class="section">
    <div class="homepod-container">
      <div class="homepod">
        <div class="start"></div>
        <div class="part-1"></div>
        <div class="part-2"></div>
        <div class="part-3"></div>
        <div class="part-4"></div>
        <div class="ending"></div>
      </div>
    </div>
    <div class="description-container">
      <div class="description">
        <h3>Deep bass with range you can feel.</h3>
        <p>The Apple-designed high-excursion woofer is positioned at the top of the speaker facing upward, creating a
          wide range of deep bass that surpasses any traditional speaker. A six-microphone array, along with an internal
          bass-EQ microphone, analyzes and compensates for the effect of the room on the bass response, providing rich,
          consistent sound. And a powerful motor drives the diaphragm a remarkable 20 mm, so the bass shines through
          even when the volume is low.</p>
      </div>

      <div class="description">
        <h3>Far and away an incredible listener.</h3>
        <p>Six microphones positioned around HomePod allow it to pick up all the sound in a room. When you say “Hey
          Siri,” advanced signal processing, together with echo and noise cancellation, allows HomePod to hear you
          without the need to raise your voice — even if you’re across the room with loud music playing. After HomePod
          recognizes the words “Hey Siri,” what you say is encrypted and sent anonymously to Apple servers without being
          tied to your Apple ID.</p>
      </div>

      <div class="description">
        <h3>High-fidelity audio that’s all around you.</h3>
        <p>A custom-designed array of seven beamforming tweeters, each with its own amplifier, creates tremendous
          directional control. Placed around the base and using a folded-horn design, they send the flow of music toward
          the center and then out the bottom in a 360-degree pattern, resulting in an all-encompassing sense of space.
          This virtually eliminates early table reflections and allows for consistent high-definition sound.</p>
      </div>

      <div class="description">
        <h3>The biggest brain ever in a speaker.</h3>
        <p>An Apple-designed A8 chip orchestrates all the remarkable audio innovations inside HomePod. Like advanced
          signal processing so Siri can hear you over the music. Real-time studio-level processing that maximizes the
          bass while minimizing distortion. Buffering that’s even faster than real time. And upmixing of both direct and
          ambient audio. You get amazing sound, every single time.</p>
      </div>

      <div class="description">
        <h3>Designed to be seen and heard.</h3>
        <p>HomePod is wrapped in a seamless mesh fabric designed for aesthetics and acoustic performance. Available in
          white and space gray, it’s gorgeous from every angle — yet virtually transparent to the sound waves passing
          through it.</p>
      </div>
    </div>
  </div>
  <!-- 后续内容1 -->
  <div class="other-section">
    <div class="sticky-container">
      <div class="iphone black">
        <h3>
          Comes in Black.<br>
          &nbsp;
        </h3>
        <img src="https://www.apple.com/v/iphone-se/b/images/overview/finishes_black__b06syayq94wi_medium_2x.png">
      </div>
      <div class="iphone white">
        <h3>
          Comes in Black.<br>
          <span>White</span>
        </h3>
        <img src="https://www.apple.com/v/iphone-se/b/images/overview/finishes_white__drv9fwq9vzwy_medium_2x.png">
      </div>
      <div class="iphone red">
        <h3>
          Comes in Black.<br>
          White. <span>And Pow.</span>
        </h3>
        <img src="https://www.apple.com/v/iphone-se/b/images/overview/finishes_red__eqfv1ongy282_medium_2x.png">
      </div>
    </div>
  </div>

  <!--后续内容2  -->
  <div class="other-section2">
    <h2>
      Superfast wireless
      <p>Hello 5G.</p>
    </h2>
    <div id="iphone">
      <div id="hardware"></div>
      <div id="ui">
        <img src="https://assets.codepen.io/2002878/iphone12-5g_top_ui.jpg" class="top-ui" alt="">

        <ul>
          <li>
            <img src="https://assets.codepen.io/2002878/iphone12-5g_show_01.jpg" />
          </li>
          <li>
            <img src="https://assets.codepen.io/2002878/iphone12-5g_show_02.jpg" />
          </li>
          <li>
            <img src="https://assets.codepen.io/2002878/iphone12-5g_show_03.jpg" />
          </li>
          <li>
            <img src="https://assets.codepen.io/2002878/iphone12-5g_show_04.jpg" />
          </li>
          <li>
            <img src="https://assets.codepen.io/2002878/iphone12-5g_show_05.jpg" />
          </li>
          <li>
            <img src="https://assets.codepen.io/2002878/iphone12-5g_show_06.jpg" />
          </li>
          <li>
            <img src="https://assets.codepen.io/2002878/iphone12-5g_show_07.jpg" />
          </li>
        </ul>
      </div>
    </div>
  </div>

  <!--后续内容3  -->
  <div class="other-section3">
    <section id="chip-section">
      <video
        src="https://www.apple.com/105/media/us/iphone-se/2020/90024c0f-285a-4bf5-af04-2c38de97b06e/anim/arcade-loop/large.mp4"
        muted playsinline autoplay loop></video>
      <h1>
        iPhone 11 Pro called.<br>
        It wants its chip back.
      </h1>
      <div id="the-chip">
        <svg viewBox="0 0 1000 1000" id="A13">
          <rect class="text-bg" x="78" y="307" width="843" height="387"></rect>
          <path
            d="M893.839695,31 L895.066071,31.0099354 C935.054114,31.6582805 967.348376,63.956556 967.990262,103.946169 L968,105.160305 L968,894.839695 L967.990065,896.066071 C967.341719,936.054114 935.043444,968.348376 895.053831,968.990262 L893.839695,969 L104.160305,969 L102.933929,968.990065 C62.9458856,968.341719 30.6516243,936.043444 30.0097379,896.053831 L30,894.839695 L30,105.160305 L30.0099354,103.933929 C30.6582805,63.9458856 62.956556,31.6516243 102.946169,31.0097379 L104.160305,31 L893.839695,31 Z M746.261438,399 C720.891068,399 697.908497,406.178571 686.267974,413.65625 L695.520697,446.558036 C703.281046,441.772321 719.995643,434.892857 735.814815,434.892857 C755.215686,434.892857 764.46841,443.566964 764.46841,455.232143 C764.46841,471.683036 745.366013,477.665179 730.143791,477.665179 L712.235294,477.665179 L712.235294,510.267857 L730.740741,510.267857 C750.738562,510.267857 769.840959,518.941964 769.840959,538.383929 C769.840959,552.741071 757.901961,564.107143 734.32244,564.107143 C715.816993,564.107143 697.311547,556.629464 689.252723,552.142857 L680,586.540179 C691.342048,593.419643 712.533769,600 737.605664,600 C786.854031,600 817,574.875 817,540.776786 C817,515.053571 798.196078,497.40625 774.915033,493.21875 L774.915033,492.620536 C798.793028,484.544643 810.433551,468.09375 810.433551,447.455357 C810.433551,420.834821 787.45098,399 746.261438,399 Z M486.512195,395 L427,395 L366,596 L412.717073,596 L427,544.408012 L484.429268,544.408012 L499.902439,596 L549,596 L486.512195,395 Z M644,402 L606.667785,402 L555,425.876923 L562.466443,459.901538 L599.5,442.292308 L600.097315,442.292308 L600.097315,596 L644,596 L644,402 Z M240.531042,404.280688 L237.283702,405.468274 C227.238818,409.107297 221.243767,410.93207 219.349668,410.93207 C216.554106,410.93207 210.17784,409.031898 200.247412,405.284905 L198.837992,404.763898 C189.530001,401.373803 181.984244,399.650292 176.164334,399.650292 C164.996112,399.837018 154.625512,402.75553 145.027551,408.482713 C135.647735,414.079741 128.110486,421.657892 122.392498,431.23034 L121.99652,431.901421 C114.661865,444.214093 111,458.907077 111,475.942715 C111,490.81457 113.715961,506.175987 119.133835,522.039516 C124.192702,536.726222 130.650134,549.608473 138.504565,560.717633 L139.862999,562.632356 C146.584254,572.026688 152.241437,578.731806 156.82169,582.747709 C164.32913,589.765174 171.850072,593.175357 179.394841,592.993063 L179.838678,592.978196 C184.897548,592.805595 191.514187,591.063893 199.727635,587.721741 C207.928586,584.395242 215.595715,582.747709 222.744623,582.747709 C229.561062,582.747709 237.015908,584.395242 245.127887,587.721741 C253.213333,591.063893 260.159327,592.711447 265.919035,592.711447 C273.942048,592.523152 281.434355,589.212369 288.42717,582.747709 C292.938164,578.809281 298.791526,571.716976 305.940438,561.470815 C311.185053,553.954856 315.711655,545.779887 319.535849,536.898823 C321.11236,533.133 322.595212,529.210267 324,525.114938 C317.771435,522.489722 312.148969,518.834501 307.090999,514.135332 L306.486749,513.56642 C294.982938,502.849509 289.129576,489.352176 288.957877,473.132468 C288.770571,452.309041 298.182783,436.076779 317.210116,424.487459 C306.580405,409.298642 290.59682,400.867905 269.32179,399.141902 C261.470478,398.4719 251.886573,400.172802 240.531042,404.280688 Z M454.966443,430 L455.557047,430 L458.400752,441.493321 C460.667056,450.623403 463.132186,460.315337 465.597315,468.571429 L478,511 L434,511 L445.812081,468.571429 C449.060403,457 452.013423,441.868132 454.966443,430 Z M269.735915,340 C263.351502,340.327936 256.563201,342.242941 249.386557,345.705743 C242.194375,349.220995 236.263544,353.627625 231.600286,358.927326 C222.259769,369.394476 217,382.196201 217,394.158222 C217,395.811495 217.107185,397.384794 217.292036,398.879663 C231.799116,400.04695 245.176874,392.649512 256.236994,379.84778 C265.401969,369.079203 270,357.444914 270,344.984462 C270,343.33164 269.922334,341.665768 269.735915,340 Z"
            class="chip-mask"></path>
          <path
            d="M894.279877,0 C952.083613,0 999.052244,46.3905942 999.985837,103.971847 L1000,105.720123 L1000,894.279877 C1000,952.083613 953.609406,999.052244 896.028153,999.985837 L894.279877,1000 L105.720123,1000 C47.9163872,1000 0.947755733,953.609406 0.0141634759,896.028153 L0,894.279877 L0,105.720123 C0,47.9163872 46.3905942,0.947755733 103.971847,0.0141634759 L105.720123,0 L894.279877,0 Z M892.997819,31 L105.002181,31 C64.5406078,31 31.6634119,63.4725801 31.0099142,103.77842 L31,105.002181 L31,892.997819 C31,933.459392 63.4725801,966.336588 103.77842,966.990086 L105.002181,967 L892.997819,967 C933.459392,967 966.336588,934.52742 966.990086,894.22158 L967,892.997819 L967,105.002181 C967,64.5406078 934.52742,31.6634119 894.22158,31.0099142 L892.997819,31 Z"
            class="chip"></path>
        </svg>
      </div>
    </section>
  </div>
  <!--后续内容4  -->
  <div class="other-section4">
    <div id="sticky">
      <canvas id="iphone-se" width="432" height="976"></canvas>
      <div id="loading">
        <p>iPhone SE packs our most powerful chip into our most popular size at our most affordable price. It’s just
          what you’ve been waiting for.</p>
      </div>

      <p class="left">
        Durable glass and<br>aluminum design
      </p>

      <p class="right">
        Brilliant 4.7”<br>Retina HD<br>display
      </p>
    </div>
  </div>
</body>
<script src="./jquery-3.6.0.js"></script>
<script src="./PxLoader.min.js"></script>
<script src="./PxLoaderImage.js"></script>
<script>
  const sectionHeight = $('.section').height();
  const homepodSection = $('.section')[0];
  const iphoneHeight = $('.other-section').height();
  const slidingListHeight = $('.other-section2').height();
  const rows = document.querySelectorAll('#ui ul li');
  const A13Height = $('.other-section3').height();
  let $h1 = $('.other-section3 h1')[0]
  let $theChip = $('#the-chip')[0]
  let $A13 = $('#A13')[0]
  let $A13TextBg = $('#the-chip .text-bg')[0]
  let SErotation = $('.other-section4').height();

  // const sectionHeight = homepodSection.getBoundingClientRect().height
  $(window).on('scroll', function (e) {
    let scrolled = $(window).scrollTop() / (sectionHeight - $(window).height())
    let noStickyOffset = $(window).height() * 2
    let iphonescrolled = $(window).scrollTop() / noStickyOffset
    let slidingList = $(window).scrollTop() / (slidingListHeight - $(window).height())
    let A13scrolled = ($(window).scrollTop() - 13390) / (A13Height - $(window).height())
    let SEscrolled = ($(window).scrollTop() - 16396) / (SErotation - $(window).height())
    homepodSection.style.setProperty('--part-1', calculateOpacity(0.05, 0.15, scrolled))
    homepodSection.style.setProperty('--part-2', calculateOpacity(0.19, 0.23, scrolled))
    homepodSection.style.setProperty('--part-3', calculateOpacity(0.35, 0.40, scrolled))
    homepodSection.style.setProperty('--part-4', calculateOpacity(0.58, 0.63, scrolled))
    homepodSection.style.setProperty('--ending', calculateOpacity(0.80, 0.85, scrolled))
    iphoneClolrs(iphonescrolled)
    slidingLists(slidingList)
    A13animation(A13scrolled)
    let frame = Math.ceil(SEscrolled * 84)
    changeFrame(frame)
    moveDevice($('#iphone-se'), SEscrolled, 0.3, 0.6, 0.6, 1)
    showHideText($('.left'), SEscrolled, 0.45, 0.52, 0.58, 0.65)
    showHideText($('.right'), SEscrolled, 0.9, 1)
  })

  function calculateOpacity(start, end, percent) {
    if (percent - start < 0) return 0
    if (percent - end > 0) return 1
    return (percent - start) / (end - start)
  }

  function iphoneClolrs(iphonescrolled) {
    let $white = $('.white')[0]
    let $red = $('.red')[0]
    $white.style.clipPath =
      `inset(${((4.826574172892209  - iphonescrolled) / 0.5 ) * 100}% 0 0 0 )`
    $red.style.clipPath =
      `inset(${((5.326574172892209  - iphonescrolled) / 0.5) * 100}% 0 0 0 )`
    if (iphonescrolled >= 5.3580576307363925) {
      $('.sticky-container').addClass('no-sticky')
    } else {
      $('.sticky-container').removeClass('no-sticky')
    }
  }

  function slidingLists(slidingList) {
    let total = 1 / rows.length; // 1/7
    for (let [index, row] of rows.entries()) {
      let start = total * (index + 102.4)
      let end = total * (index + 103.4)
      let progress = (slidingList - start) / (end - start)
      // console.log(`${index}: ${start} - ${end}`)
      if (progress >= 1) progress = 1
      if (progress <= 0) progress = 0
      row.style.setProperty('--progress', progress)
    }
  }

  function A13animation(A13scrolled) {
    $theChip.style.width = $theChip.style.height = $(document).innerWidth() * 20 * (A13scrolled * A13scrolled *
      A13scrolled) + 'px'

    if (A13scrolled < 0.1 && A13scrolled >= -2) {
      $h1.style.opacity = (0.1 - A13scrolled) / 0.1
      $h1.style.marginTop = A13scrolled * 1000 * -1 + 'px'
    } else {
      $h1.style.opacity = 0
    }

    if (A13scrolled < 0.2) {
      $A13.style.opacity = (A13scrolled - 0.1) / 0.1
    } else {
      $A13.style.opacity = 1
    }

    if (A13scrolled >= 0.5) {
      $A13TextBg.style.opacity = (1 - A13scrolled) / 0.5
      $('#the-chip').addClass('transparent')
    } else {
      $A13TextBg.style.opacity = 1
      $('#the-chip').removeClass('transparent')
    }

    if (A13scrolled >= 0.95) {
      $theChip.style.opacity = (0.9723703344643723 - A13scrolled) / 0.05
    } else {
      $theChip.style.opacity = 1
    }
  }
  const images = []
  const loader = new PxLoader()
  for (var i = 0; i < 85; i++) {
    images[i] = loader.addImage(
      `https://s3-us-west-2.amazonaws.com/s.cdpn.io/2002878/iphone-se.${('0' + (i + 1)).slice(-2)}.png`)

  }
  loader.addCompletionListener(function () {
    let context = $('#iphone-se')[0].getContext('2d')
    $('.other-section4').addClass('loaded')

    context.drawImage(images[0], 0, 0, 432, 976)
  })
  loader.start()

  function changeFrame(frame) {
    let index = frame - 1
    if (index < 0) index = 0
    if (index > 84) index = 84
    let context = $('#iphone-se')[0].getContext('2d')
    context.drawImage(images[index], 0, 0, 432, 976)
  }

  function moveDevice(el, current, toLeftFrom, toLeftTo, toRightFrom, toRightTo) {
    if (current <= toLeftTo) {
      if (current >= toLeftFrom) {
        let offsetRatio = (current - toLeftFrom) / (toLeftTo - toLeftFrom)
        $(el).css('left', $(el).width() / 2 * -1 * offsetRatio)
      }
    } else {
      let offsetRatio = (current - toRightFrom) / (toRightTo - toRightFrom)
      $(el).css('left', $(el).width() / 2 * -1 + $(el).width() *
        offsetRatio)
    }
  }

  function showHideText(el, current, showFrom, showTo, hideFrom, hideTo) {
    if (current < showFrom) {
      $(el).css('opacity', 0)
    }

    if (current >= showFrom && current <= showTo) {
      $(el).css('opacity', (current - showFrom) / (showTo - showFrom))
    }

    if (typeof hideFrom !== 'undefined' && typeof hideTo !== 'undefined') {
      if (current > hideFrom && current <= hideTo) {
        $(el).css('opacity', (hideTo - current) / (hideTo - hideFrom))
      }

      if (current > hideTo) {
        $(el).css('opacity', 0)
      }
    }
  }
</script>

</html>
